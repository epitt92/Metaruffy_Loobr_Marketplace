import { ethers } from 'ethers';
import Link from 'next/link';
import React, { useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import useMetaMask from '../../hooks/useMetaMask';
import { sendGift } from '../../redux/nft/actions';
import Button from '../Button/Button';
import Input from '../input/Input';
import Popups from '../../components/popup/poups';
import blockchains from '../../contractsData/blockchains';

const GiftModal = ({ setstate, data }: any) => {
    const [popup, setPopup] = useState(false);
    const [state, setState] = useState(-1);

    const { library, account, switchNetwork }: any = useMetaMask();
    const [address, setAddress] = useState('');
    const [error, setError] = useState(false);

    const loading = useSelector((state: any) => state.nft.giftLoading);

    const dispatch = useDispatch();

    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
        error && setError(false);
        setAddress(event.target.value);
    };
    const handleSubmit = async (event: React.ChangeEvent<HTMLFormElement>) => {
        event.preventDefault();

        if (!ethers?.utils?.isAddress(address)) {
            setError(true);
            return;
        }
        const chain = blockchains.find((item) => item?.symbol == data?.chain);
        const status = await switchNetwork(chain?.chainId);
        if (!status) {
            return;
        }
        const signer = library?.getSigner();
        // @ts-ignore
        dispatch(sendGift(signer, data?.tokenId, account, address, setstate, data?.contractAddress));
    };
    return (
        <div className="w-full md:w-[695px] sm:w-[500px]  m-auto rounded-lg ">
            <div className="pt-6 text-center pb-[24px] border-b-[1px] border-[#1F1F2A]">
                <h2 className="text-2xl text-white font-Proxima-SemiBold">Transfer your NFT</h2>
            </div>
            <div className="pt-6 px-8 pb-8">
                <form onSubmit={handleSubmit}>
                    <p className="text-white font-Proxima-SemiBold text-2xl mb-5">Address</p>
                    <div className="grid grid-cols-1">
                        <div className="!relative h-[45px]">
                            <Input
                                className="pr-16"

                                type="text"
                                placeholder="e.g. 0ed25cec5e5ecee5f1r5f1f1"
                                name="address"
                                value={address}
                                onchange={handleChange}
                                error={error}
                                helperText={'Incorrect address.'}

                                
                            />
                            <div
                                className="absolute top-1/2 -translate-y-1/2 right-3 cursor-pointer "
                                onClick={() => {
                                    setPopup(true);
                                    setState(65);
                                }}>
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 40 40"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M13 35.75H6C5.53587 35.75 5.09075 35.5656 4.76256 35.2374C4.43437 34.9092 4.25 34.4641 4.25 34V27C4.25 26.5359 4.06563 26.0908 3.73744 25.7626C3.40925 25.4344 2.96413 25.25 2.5 25.25C2.03587 25.25 1.59075 25.4344 1.26256 25.7626C0.934374 26.0908 0.75 26.5359 0.75 27V34C0.75 35.3924 1.30312 36.7277 2.28769 37.7123C3.27226 38.6969 4.60761 39.25 6 39.25H13C13.4641 39.25 13.9092 39.0656 14.2374 38.7374C14.5656 38.4092 14.75 37.9641 14.75 37.5C14.75 37.0359 14.5656 36.5908 14.2374 36.2626C13.9092 35.9344 13.4641 35.75 13 35.75V35.75ZM37.5 25.25C37.0359 25.25 36.5908 25.4344 36.2626 25.7626C35.9344 26.0908 35.75 26.5359 35.75 27V34C35.75 34.4641 35.5656 34.9092 35.2374 35.2374C34.9092 35.5656 34.4641 35.75 34 35.75H27C26.5359 35.75 26.0908 35.9344 25.7626 36.2626C25.4344 36.5908 25.25 37.0359 25.25 37.5C25.25 37.9641 25.4344 38.4092 25.7626 38.7374C26.0908 39.0656 26.5359 39.25 27 39.25H34C35.3924 39.25 36.7277 38.6969 37.7123 37.7123C38.6969 36.7277 39.25 35.3924 39.25 34V27C39.25 26.5359 39.0656 26.0908 38.7374 25.7626C38.4092 25.4344 37.9641 25.25 37.5 25.25ZM34 0.75H27C26.5359 0.75 26.0908 0.934374 25.7626 1.26256C25.4344 1.59075 25.25 2.03587 25.25 2.5C25.25 2.96413 25.4344 3.40925 25.7626 3.73744C26.0908 4.06563 26.5359 4.25 27 4.25H34C34.4641 4.25 34.9092 4.43437 35.2374 4.76256C35.5656 5.09075 35.75 5.53587 35.75 6V13C35.75 13.4641 35.9344 13.9092 36.2626 14.2374C36.5908 14.5656 37.0359 14.75 37.5 14.75C37.9641 14.75 38.4092 14.5656 38.7374 14.2374C39.0656 13.9092 39.25 13.4641 39.25 13V6C39.25 4.60761 38.6969 3.27226 37.7123 2.28769C36.7277 1.30312 35.3924 0.75 34 0.75V0.75ZM2.5 14.75C2.96413 14.75 3.40925 14.5656 3.73744 14.2374C4.06563 13.9092 4.25 13.4641 4.25 13V6C4.25 5.53587 4.43437 5.09075 4.76256 4.76256C5.09075 4.43437 5.53587 4.25 6 4.25H13C13.4641 4.25 13.9092 4.06563 14.2374 3.73744C14.5656 3.40925 14.75 2.96413 14.75 2.5C14.75 2.03587 14.5656 1.59075 14.2374 1.26256C13.9092 0.934374 13.4641 0.75 13 0.75H6C4.60761 0.75 3.27226 1.30312 2.28769 2.28769C1.30312 3.27226 0.75 4.60761 0.75 6V13C0.75 13.4641 0.934374 13.9092 1.26256 14.2374C1.59075 14.5656 2.03587 14.75 2.5 14.75ZM16.5 7.75H9.5C9.03587 7.75 8.59075 7.93437 8.26256 8.26256C7.93437 8.59075 7.75 9.03587 7.75 9.5V16.5C7.75 16.9641 7.93437 17.4092 8.26256 17.7374C8.59075 18.0656 9.03587 18.25 9.5 18.25H16.5C16.9641 18.25 17.4092 18.0656 17.7374 17.7374C18.0656 17.4092 18.25 16.9641 18.25 16.5V9.5C18.25 9.03587 18.0656 8.59075 17.7374 8.26256C17.4092 7.93437 16.9641 7.75 16.5 7.75ZM14.75 14.75H11.25V11.25H14.75V14.75ZM23.5 18.25H30.5C30.9641 18.25 31.4092 18.0656 31.7374 17.7374C32.0656 17.4092 32.25 16.9641 32.25 16.5V9.5C32.25 9.03587 32.0656 8.59075 31.7374 8.26256C31.4092 7.93437 30.9641 7.75 30.5 7.75H23.5C23.0359 7.75 22.5908 7.93437 22.2626 8.26256C21.9344 8.59075 21.75 9.03587 21.75 9.5V16.5C21.75 16.9641 21.9344 17.4092 22.2626 17.7374C22.5908 18.0656 23.0359 18.25 23.5 18.25ZM25.25 11.25H28.75V14.75H25.25V11.25ZM16.5 21.75H9.5C9.03587 21.75 8.59075 21.9344 8.26256 22.2626C7.93437 22.5908 7.75 23.0359 7.75 23.5V30.5C7.75 30.9641 7.93437 31.4092 8.26256 31.7374C8.59075 32.0656 9.03587 32.25 9.5 32.25H16.5C16.9641 32.25 17.4092 32.0656 17.7374 31.7374C18.0656 31.4092 18.25 30.9641 18.25 30.5V23.5C18.25 23.0359 18.0656 22.5908 17.7374 22.2626C17.4092 21.9344 16.9641 21.75 16.5 21.75ZM14.75 28.75H11.25V25.25H14.75V28.75ZM23.5 27C23.9641 27 24.4092 26.8156 24.7374 26.4874C25.0656 26.1592 25.25 25.7141 25.25 25.25C25.7141 25.25 26.1592 25.0656 26.4874 24.7374C26.8156 24.4092 27 23.9641 27 23.5C27 23.0359 26.8156 22.5908 26.4874 22.2626C26.1592 21.9344 25.7141 21.75 25.25 21.75H23.5C23.0359 21.75 22.5908 21.9344 22.2626 22.2626C21.9344 22.5908 21.75 23.0359 21.75 23.5V25.25C21.75 25.7141 21.9344 26.1592 22.2626 26.4874C22.5908 26.8156 23.0359 27 23.5 27ZM30.5 21.75C30.0359 21.75 29.5908 21.9344 29.2626 22.2626C28.9344 22.5908 28.75 23.0359 28.75 23.5V28.75C28.2859 28.75 27.8408 28.9344 27.5126 29.2626C27.1844 29.5908 27 30.0359 27 30.5C27 30.9641 27.1844 31.4092 27.5126 31.7374C27.8408 32.0656 28.2859 32.25 28.75 32.25H30.5C30.9641 32.25 31.4092 32.0656 31.7374 31.7374C32.0656 31.4092 32.25 30.9641 32.25 30.5V23.5C32.25 23.0359 32.0656 22.5908 31.7374 22.2626C31.4092 21.9344 30.9641 21.75 30.5 21.75ZM23.5 28.75C23.1539 28.75 22.8155 28.8526 22.5278 29.0449C22.24 29.2372 22.0157 29.5105 21.8832 29.8303C21.7508 30.1501 21.7161 30.5019 21.7836 30.8414C21.8511 31.1809 22.0178 31.4927 22.2626 31.7374C22.5073 31.9822 22.8191 32.1489 23.1586 32.2164C23.4981 32.2839 23.8499 32.2492 24.1697 32.1168C24.4895 31.9843 24.7628 31.76 24.9551 31.4722C25.1474 31.1845 25.25 30.8461 25.25 30.5C25.25 30.0359 25.0656 29.5908 24.7374 29.2626C24.4092 28.9344 23.9641 28.75 23.5 28.75Z"
                                        fill="white"
                                    />
                                </svg>
                            </div>
                        </div>
                        <div className="mt-9 flex items-center gap-2">
                            <svg
                                width="22"
                                height="20"
                                viewBox="0 0 22 20"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M9.87559 14.875C9.87559 15.1734 9.99412 15.4595 10.2051 15.6705C10.4161 15.8815 10.7022 16 11.0006 16C11.299 16 11.5851 15.8815 11.7961 15.6705C12.0071 15.4595 12.1256 15.1734 12.1256 14.875C12.1256 14.5766 12.0071 14.2905 11.7961 14.0795C11.5851 13.8685 11.299 13.75 11.0006 13.75C10.7022 13.75 10.4161 13.8685 10.2051 14.0795C9.99412 14.2905 9.87559 14.5766 9.87559 14.875ZM10.2506 7.75V12.0625C10.2506 12.1656 10.335 12.25 10.4381 12.25H11.5631C11.6662 12.25 11.7506 12.1656 11.7506 12.0625V7.75C11.7506 7.64687 11.6662 7.5625 11.5631 7.5625H10.4381C10.335 7.5625 10.2506 7.64687 10.2506 7.75ZM21.3998 18.0625L11.6498 1.1875C11.5045 0.936719 11.2537 0.8125 11.0006 0.8125C10.7475 0.8125 10.4943 0.936719 10.3514 1.1875L0.601375 18.0625C0.313094 18.5641 0.674031 19.1875 1.25059 19.1875H20.7506C21.3272 19.1875 21.6881 18.5641 21.3998 18.0625ZM3.03653 17.4086L11.0006 3.62266L18.9647 17.4086H3.03653Z"
                                    fill="#EFC74D"
                                />
                            </svg>
                            <p className="font-Proxima-SemiBold text-sm text-[#43434C] ">
                                Items sent to the wrong address cannot be recovered
                            </p>
                        </div>
                    </div>
                    <Link legacyBehavior href="#">
                        <a>
                            <Button
                                className="w-full mt-[1.75rem] gold rounded-[1.875rem]"
                                type="button"
                                disabled={loading}
                                isLoading={loading}
                                onClick={handleSubmit}>
                                Submit
                            </Button>
                        </a>
                    </Link>
                </form>
            </div>

            {state && <Popups show={popup} hide={setPopup} state={state} setstate={setState} data={{ setAddress }} />}
        </div>
    );
};

export default GiftModal;
