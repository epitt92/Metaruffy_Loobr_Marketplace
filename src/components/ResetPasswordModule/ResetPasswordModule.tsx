import React, { useEffect, useState } from "react";
import Link from "next/link";
import Input from "../input/Input";
import Button from "../Button/Button";
import { useDispatch, useSelector } from "react-redux";
import { handleResetPassword } from "../../redux/auth/actions";
import { isEmpty, validate } from "validate.js";
import { resetPassword } from "../../validations";

export const ResetPasswordModule = ({ setstate }: any) => {
  const [values, setValues] = useState({
    email: "",
    password: "",
    confirmPassword: "",
    code: "",
  });
  const [touched, setTouched] = useState<any>({});
  const [errors, setErrors] = useState<any>({});
  const [viewFields, setViewFields] = useState<any>({});

  const loading = useSelector((state: any) => state.auth.forgotPasswordLoading);

  const dispatch = useDispatch();

  useEffect(() => {
    const errors = validate(values, resetPassword);
    setErrors({ ...(errors || {}) });
  }, [values]);

  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    setValues({ ...values, [event.target.name]: event.target.value });
  };

  const handleSubmit = (e: React.ChangeEvent<HTMLFormElement>) => {
    e.preventDefault();
    enabledTouchedValues();
    if (!isEmpty(errors)) {
      return;
    }
    dispatch(handleResetPassword(values, setstate));
  };

  const handleBlur = (e: React.ChangeEvent<HTMLInputElement>) => {
    e.persist();
    setTouched({ ...touched, [e.target.name]: true });
  };

  const hadnleViewFields = (field: string, show: boolean) => {
    setViewFields({ ...viewFields, [field]: show });
  };

  const hasError = (field: string) =>
    touched[field] && errors[field] ? true : false;

  const enabledTouchedValues = () => {
    const newState: any = {};
    Object.keys(errors).forEach((item) => {
      newState[item] = true;
    });
    setTouched(newState);
  };

  return (
    <div className="w-full md:w-[694px] sm:w-[594px] m-auto rounded-lg">
      <div className="border-b border-[#43434C] py-6 text-center">
        <h2 className="text-2xl text-white">Reset Password</h2>
      </div>
      <form onSubmit={handleSubmit}>
        <div className="pt-6 px-8 pb-8">
          <h3 className="text-2rem text-white mb-2">Reset Password?</h3>
          <p className="text-gray6 text-base mb-4">
            Please enter new password for you account.
          </p>
          <div className="grid grid-cols-1 mb-4">
            <Input
              placeholder="Email Address"
              name="email"
              value={values.email}
              onchange={handleChange}
              onBlur={handleBlur}
              error={hasError("email")}
              helperText={hasError("email") ? errors.email[0] : null}
            />
          </div>
          <div className="grid grid-cols-1 mb-4">
            <Input
              placeholder="Security Code"
              name="code"
              value={values.code}
              onchange={handleChange}
              svgicon="right-5 top-1/2 -translate-y-1/2 cursor-pointer"
              type={viewFields["code"] ? "text" : "password"}
              svgIconName={
                !viewFields["code"] ? (
                  <svg
                    width="20"
                    height="17"
                    viewBox="0 0 20 17"
                    fill="none"
                    className=" cursor-pointer"
                    xmlns="http://www.w3.org/2000/svg"
                    onClick={() => {
                      hadnleViewFields("code", true);
                    }}
                  >
                    <path
                      d="M10.003 0.000488281C14.139 0.00348828 17.853 2.90249 19.939 7.75649C20.021 7.94549 20.021 8.15949 19.939 8.34849C17.854 13.2035 14.139 16.1025 10.003 16.1055H9.99699C5.86099 16.1025 2.14699 13.2035 0.0609941 8.34849C-0.0200059 8.15949 -0.0200059 7.94549 0.0609941 7.75649C2.14699 2.90249 5.86199 0.00348828 9.99699 0.000488281H10.003ZM9.99999 1.50049C6.56399 1.50149 3.42999 3.94449 1.56999 8.05249C3.42999 12.1615 6.56299 14.6045 9.99999 14.6055C13.437 14.6045 16.57 12.1615 18.43 8.05249C16.57 3.94449 13.437 1.50149 9.99999 1.50049ZM9.99969 4.14129C12.1567 4.14129 13.9117 5.89629 13.9117 8.05329C13.9117 10.2093 12.1567 11.9633 9.99969 11.9633C7.84269 11.9633 6.08869 10.2093 6.08869 8.05329C6.08869 5.89629 7.84269 4.14129 9.99969 4.14129ZM9.99969 5.64129C8.66969 5.64129 7.58869 6.72329 7.58869 8.05329C7.58869 9.38229 8.66969 10.4633 9.99969 10.4633C11.3297 10.4633 12.4117 9.38229 12.4117 8.05329C12.4117 6.72329 11.3297 5.64129 9.99969 5.64129Z"
                      fill="#F1C94A"
                    />
                  </svg>
                ) : (
                  <svg
                    width="20"
                    height="17"
                    viewBox="0 0 22 22"
                    fill="none"
                    className=" cursor-pointer"
                    xmlns="http://www.w3.org/2000/svg"
                    onClick={() => {
                      hadnleViewFields("code", false);
                    }}
                  >
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M21.2804 0.469672C21.5733 0.762567 21.5733 1.23744 21.2804 1.53033L1.28033 21.5304C0.98744 21.8233 0.512567 21.8233 0.219672 21.5304C-0.0732223 21.2375 -0.0732243 20.7626 0.219668 20.4697L3.59007 17.0993C2.63583 16.2323 1.76266 15.1886 1.00731 14.003C0.462133 13.1486 0.214844 12.054 0.214844 11.005C0.214844 9.95594 0.462142 8.86136 1.00734 8.00695C3.39826 4.24858 6.90186 1.97998 10.7498 1.97998C12.8835 1.97998 14.9329 2.68491 16.7307 3.95861L20.2197 0.469668C20.5126 0.176776 20.9875 0.176778 21.2804 0.469672ZM15.6525 5.03686C14.1376 4.01888 12.4627 3.47998 10.7498 3.47998C7.53799 3.47998 4.46174 5.37118 2.27266 8.81252L2.27204 8.81351C1.91745 9.36902 1.71484 10.1642 1.71484 11.005C1.71484 11.8457 1.91745 12.6409 2.27204 13.1965C2.97564 14.3008 3.7833 15.2574 4.6521 16.0372L7.20494 13.4844C6.71039 12.7816 6.41992 11.9266 6.41992 11C6.41992 8.60583 8.35571 6.67004 10.7499 6.67004C11.6765 6.67004 12.5315 6.96051 13.2342 7.45506L15.6525 5.03686ZM12.149 8.54033C11.7364 8.30397 11.2603 8.17004 10.7499 8.17004C9.18414 8.17004 7.91992 9.43426 7.91992 11C7.91992 11.5104 8.05385 11.9865 8.29021 12.3991L12.149 8.54033ZM18.3299 6.34564C18.6526 6.08603 19.1247 6.13722 19.3843 6.45998C19.7682 6.93725 20.1453 7.45011 20.4932 7.99819C21.0378 8.85243 21.2849 9.94649 21.2849 10.9951C21.2849 12.0439 21.0377 13.1383 20.4927 13.9926C18.1018 17.7513 14.5981 20.0201 10.7499 20.0201C9.41339 20.0201 8.10475 19.7374 6.87888 19.2213C6.49713 19.0605 6.31796 18.6208 6.4787 18.239C6.63943 17.8573 7.07921 17.6781 7.46096 17.8388C8.5151 18.2827 9.62646 18.5201 10.7499 18.5201C13.9618 18.5201 17.038 16.6289 19.2271 13.1875L19.2277 13.1865C19.5823 12.631 19.7849 11.8358 19.7849 10.9951C19.7849 10.1543 19.5823 9.3591 19.2277 8.80358L19.2267 8.80192C18.9145 8.31 18.5716 7.84285 18.2155 7.40012C17.9559 7.07736 18.0071 6.60526 18.3299 6.34564ZM14.3959 10.9624C14.8033 11.0375 15.0726 11.4286 14.9975 11.836C14.6811 13.5518 13.2918 14.9411 11.5759 15.2575C11.1686 15.3326 10.7775 15.0633 10.7024 14.656C10.6273 14.2486 10.8966 13.8575 11.3039 13.7824C12.4081 13.5788 13.3188 12.6681 13.5224 11.5639C13.5975 11.1566 13.9886 10.8873 14.3959 10.9624Z"
                      fill="#F1C94A"
                    />
                  </svg>
                )
              }
              onBlur={handleBlur}
              error={hasError("code")}
              helperText={hasError("code") ? errors.code[0] : null}
            />
          </div>
          <div className="grid grid-cols-1 mb-4">
            <Input
              placeholder="New Password"
              name="password"
              value={values.password}
              onchange={handleChange}
              svgicon="right-5 top-1/2 -translate-y-1/2 cursor-pointer"
              type={viewFields["password"] ? "text" : "password"}
              svgIconName={
                !viewFields["password"] ? (
                  <svg
                    width="20"
                    height="17"
                    viewBox="0 0 20 17"
                    fill="none"
                    className=" cursor-pointer"
                    xmlns="http://www.w3.org/2000/svg"
                    onClick={() => {
                      hadnleViewFields("password", true);
                    }}
                  >
                    <path
                      d="M10.003 0.000488281C14.139 0.00348828 17.853 2.90249 19.939 7.75649C20.021 7.94549 20.021 8.15949 19.939 8.34849C17.854 13.2035 14.139 16.1025 10.003 16.1055H9.99699C5.86099 16.1025 2.14699 13.2035 0.0609941 8.34849C-0.0200059 8.15949 -0.0200059 7.94549 0.0609941 7.75649C2.14699 2.90249 5.86199 0.00348828 9.99699 0.000488281H10.003ZM9.99999 1.50049C6.56399 1.50149 3.42999 3.94449 1.56999 8.05249C3.42999 12.1615 6.56299 14.6045 9.99999 14.6055C13.437 14.6045 16.57 12.1615 18.43 8.05249C16.57 3.94449 13.437 1.50149 9.99999 1.50049ZM9.99969 4.14129C12.1567 4.14129 13.9117 5.89629 13.9117 8.05329C13.9117 10.2093 12.1567 11.9633 9.99969 11.9633C7.84269 11.9633 6.08869 10.2093 6.08869 8.05329C6.08869 5.89629 7.84269 4.14129 9.99969 4.14129ZM9.99969 5.64129C8.66969 5.64129 7.58869 6.72329 7.58869 8.05329C7.58869 9.38229 8.66969 10.4633 9.99969 10.4633C11.3297 10.4633 12.4117 9.38229 12.4117 8.05329C12.4117 6.72329 11.3297 5.64129 9.99969 5.64129Z"
                      fill="#F1C94A"
                    />
                  </svg>
                ) : (
                  <svg
                    width="20"
                    height="17"
                    viewBox="0 0 22 22"
                    fill="none"
                    className=" cursor-pointer"
                    xmlns="http://www.w3.org/2000/svg"
                    onClick={() => {
                      hadnleViewFields("password", false);
                    }}
                  >
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M21.2804 0.469672C21.5733 0.762567 21.5733 1.23744 21.2804 1.53033L1.28033 21.5304C0.98744 21.8233 0.512567 21.8233 0.219672 21.5304C-0.0732223 21.2375 -0.0732243 20.7626 0.219668 20.4697L3.59007 17.0993C2.63583 16.2323 1.76266 15.1886 1.00731 14.003C0.462133 13.1486 0.214844 12.054 0.214844 11.005C0.214844 9.95594 0.462142 8.86136 1.00734 8.00695C3.39826 4.24858 6.90186 1.97998 10.7498 1.97998C12.8835 1.97998 14.9329 2.68491 16.7307 3.95861L20.2197 0.469668C20.5126 0.176776 20.9875 0.176778 21.2804 0.469672ZM15.6525 5.03686C14.1376 4.01888 12.4627 3.47998 10.7498 3.47998C7.53799 3.47998 4.46174 5.37118 2.27266 8.81252L2.27204 8.81351C1.91745 9.36902 1.71484 10.1642 1.71484 11.005C1.71484 11.8457 1.91745 12.6409 2.27204 13.1965C2.97564 14.3008 3.7833 15.2574 4.6521 16.0372L7.20494 13.4844C6.71039 12.7816 6.41992 11.9266 6.41992 11C6.41992 8.60583 8.35571 6.67004 10.7499 6.67004C11.6765 6.67004 12.5315 6.96051 13.2342 7.45506L15.6525 5.03686ZM12.149 8.54033C11.7364 8.30397 11.2603 8.17004 10.7499 8.17004C9.18414 8.17004 7.91992 9.43426 7.91992 11C7.91992 11.5104 8.05385 11.9865 8.29021 12.3991L12.149 8.54033ZM18.3299 6.34564C18.6526 6.08603 19.1247 6.13722 19.3843 6.45998C19.7682 6.93725 20.1453 7.45011 20.4932 7.99819C21.0378 8.85243 21.2849 9.94649 21.2849 10.9951C21.2849 12.0439 21.0377 13.1383 20.4927 13.9926C18.1018 17.7513 14.5981 20.0201 10.7499 20.0201C9.41339 20.0201 8.10475 19.7374 6.87888 19.2213C6.49713 19.0605 6.31796 18.6208 6.4787 18.239C6.63943 17.8573 7.07921 17.6781 7.46096 17.8388C8.5151 18.2827 9.62646 18.5201 10.7499 18.5201C13.9618 18.5201 17.038 16.6289 19.2271 13.1875L19.2277 13.1865C19.5823 12.631 19.7849 11.8358 19.7849 10.9951C19.7849 10.1543 19.5823 9.3591 19.2277 8.80358L19.2267 8.80192C18.9145 8.31 18.5716 7.84285 18.2155 7.40012C17.9559 7.07736 18.0071 6.60526 18.3299 6.34564ZM14.3959 10.9624C14.8033 11.0375 15.0726 11.4286 14.9975 11.836C14.6811 13.5518 13.2918 14.9411 11.5759 15.2575C11.1686 15.3326 10.7775 15.0633 10.7024 14.656C10.6273 14.2486 10.8966 13.8575 11.3039 13.7824C12.4081 13.5788 13.3188 12.6681 13.5224 11.5639C13.5975 11.1566 13.9886 10.8873 14.3959 10.9624Z"
                      fill="#F1C94A"
                    />
                  </svg>
                )
              }
              onBlur={handleBlur}
              error={hasError("password")}
              helperText={hasError("password") ? errors.password[0] : null}
            />
          </div>
          <div className="grid grid-cols-1">
            <Input
              placeholder="Confirm Password"
              name="confirmPassword"
              value={values.confirmPassword}
              onchange={handleChange}
              svgicon="right-5 top-1/2 -translate-y-1/2 cursor-pointer"
              type={viewFields["confirmPassword"] ? "text" : "password"}
              svgIconName={
                !viewFields["confirmPassword"] ? (
                  <svg
                    width="20"
                    height="17"
                    viewBox="0 0 20 17"
                    fill="none"
                    className=" cursor-pointer"
                    xmlns="http://www.w3.org/2000/svg"
                    onClick={() => {
                      hadnleViewFields("confirmPassword", true);
                    }}
                  >
                    <path
                      d="M10.003 0.000488281C14.139 0.00348828 17.853 2.90249 19.939 7.75649C20.021 7.94549 20.021 8.15949 19.939 8.34849C17.854 13.2035 14.139 16.1025 10.003 16.1055H9.99699C5.86099 16.1025 2.14699 13.2035 0.0609941 8.34849C-0.0200059 8.15949 -0.0200059 7.94549 0.0609941 7.75649C2.14699 2.90249 5.86199 0.00348828 9.99699 0.000488281H10.003ZM9.99999 1.50049C6.56399 1.50149 3.42999 3.94449 1.56999 8.05249C3.42999 12.1615 6.56299 14.6045 9.99999 14.6055C13.437 14.6045 16.57 12.1615 18.43 8.05249C16.57 3.94449 13.437 1.50149 9.99999 1.50049ZM9.99969 4.14129C12.1567 4.14129 13.9117 5.89629 13.9117 8.05329C13.9117 10.2093 12.1567 11.9633 9.99969 11.9633C7.84269 11.9633 6.08869 10.2093 6.08869 8.05329C6.08869 5.89629 7.84269 4.14129 9.99969 4.14129ZM9.99969 5.64129C8.66969 5.64129 7.58869 6.72329 7.58869 8.05329C7.58869 9.38229 8.66969 10.4633 9.99969 10.4633C11.3297 10.4633 12.4117 9.38229 12.4117 8.05329C12.4117 6.72329 11.3297 5.64129 9.99969 5.64129Z"
                      fill="#F1C94A"
                    />
                  </svg>
                ) : (
                  <svg
                    width="20"
                    height="17"
                    viewBox="0 0 22 22"
                    fill="none"
                    className=" cursor-pointer"
                    xmlns="http://www.w3.org/2000/svg"
                    onClick={() => {
                      hadnleViewFields("confirmPassword", false);
                    }}
                  >
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M21.2804 0.469672C21.5733 0.762567 21.5733 1.23744 21.2804 1.53033L1.28033 21.5304C0.98744 21.8233 0.512567 21.8233 0.219672 21.5304C-0.0732223 21.2375 -0.0732243 20.7626 0.219668 20.4697L3.59007 17.0993C2.63583 16.2323 1.76266 15.1886 1.00731 14.003C0.462133 13.1486 0.214844 12.054 0.214844 11.005C0.214844 9.95594 0.462142 8.86136 1.00734 8.00695C3.39826 4.24858 6.90186 1.97998 10.7498 1.97998C12.8835 1.97998 14.9329 2.68491 16.7307 3.95861L20.2197 0.469668C20.5126 0.176776 20.9875 0.176778 21.2804 0.469672ZM15.6525 5.03686C14.1376 4.01888 12.4627 3.47998 10.7498 3.47998C7.53799 3.47998 4.46174 5.37118 2.27266 8.81252L2.27204 8.81351C1.91745 9.36902 1.71484 10.1642 1.71484 11.005C1.71484 11.8457 1.91745 12.6409 2.27204 13.1965C2.97564 14.3008 3.7833 15.2574 4.6521 16.0372L7.20494 13.4844C6.71039 12.7816 6.41992 11.9266 6.41992 11C6.41992 8.60583 8.35571 6.67004 10.7499 6.67004C11.6765 6.67004 12.5315 6.96051 13.2342 7.45506L15.6525 5.03686ZM12.149 8.54033C11.7364 8.30397 11.2603 8.17004 10.7499 8.17004C9.18414 8.17004 7.91992 9.43426 7.91992 11C7.91992 11.5104 8.05385 11.9865 8.29021 12.3991L12.149 8.54033ZM18.3299 6.34564C18.6526 6.08603 19.1247 6.13722 19.3843 6.45998C19.7682 6.93725 20.1453 7.45011 20.4932 7.99819C21.0378 8.85243 21.2849 9.94649 21.2849 10.9951C21.2849 12.0439 21.0377 13.1383 20.4927 13.9926C18.1018 17.7513 14.5981 20.0201 10.7499 20.0201C9.41339 20.0201 8.10475 19.7374 6.87888 19.2213C6.49713 19.0605 6.31796 18.6208 6.4787 18.239C6.63943 17.8573 7.07921 17.6781 7.46096 17.8388C8.5151 18.2827 9.62646 18.5201 10.7499 18.5201C13.9618 18.5201 17.038 16.6289 19.2271 13.1875L19.2277 13.1865C19.5823 12.631 19.7849 11.8358 19.7849 10.9951C19.7849 10.1543 19.5823 9.3591 19.2277 8.80358L19.2267 8.80192C18.9145 8.31 18.5716 7.84285 18.2155 7.40012C17.9559 7.07736 18.0071 6.60526 18.3299 6.34564ZM14.3959 10.9624C14.8033 11.0375 15.0726 11.4286 14.9975 11.836C14.6811 13.5518 13.2918 14.9411 11.5759 15.2575C11.1686 15.3326 10.7775 15.0633 10.7024 14.656C10.6273 14.2486 10.8966 13.8575 11.3039 13.7824C12.4081 13.5788 13.3188 12.6681 13.5224 11.5639C13.5975 11.1566 13.9886 10.8873 14.3959 10.9624Z"
                      fill="#F1C94A"
                    />
                  </svg>
                )
              }
              onBlur={handleBlur}
              error={hasError("confirmPassword")}
              helperText={
                hasError("confirmPassword") ? errors.confirmPassword[0] : null
              }
            />
          </div>

          <Link legacyBehavior href="#">
            <a>
              <Button
                className="w-full mt-[2.75rem] gold !rounded-[1.875rem]"
                onClick={handleSubmit}
                isLoading={loading}
                disabled={loading}
                type="submit"
              >
                Reset Password
              </Button>
            </a>
          </Link>
        </div>
      </form>
    </div>
  );
};
